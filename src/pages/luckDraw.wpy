<template>
  <image src="{{titaList.banner_url}}" class="banner"></image>
  <view class="describe">
    <text class="name">{{titaList.name}}</text>
    <text class="number">{{titaList.number}}件</text>
    <label class="reachNumber">满 {{titaList.reach_number}}人 参与开奖</label>
    <view class="awardProgress">
      <text class="percentageTitle">开奖进度:</text>
      <view class="progress">
        <view style="width:{{ percentage + '%'}}"></view>
      </view>
    </view>
    <view class="participate" wx:if="{{titaList.prize_draws_count > 0}}">
      <text>已有{{titaList.prize_draws_count}}人参加，</text>
      <navigator hover-class="none" url="/pages/luckDraw?id={{item.id}}">
        查看全部>
      </navigator>
    </view>
    <view class="participatePeople" wx:if="{{titaList.prize_draws_count > 0}}">
      <image src="{{item}}" wx:for="{{tx}}" wx:key="index"></image>
    </view>
    <form bindsubmit="formSubmit" bindreset="formReset" report-submit="true" class="formSub">
      <button class="drawBtn" @getuserinfo="drawBtn" open-type="getUserInfo" formType="submit">立即参加</button>
      <text>分享给好友参加</text>
    </form>
  </view>
  <view class="sponsor">
    <text>赞助商</text>
    <image src="../assets/images/test/tx.jpg"></image>
    <label>天猫商城</label>
  </view>
  <image src="{{titaList.detail_url}}" class="commodityDisplay"  mode="widthFix"></image>
</template>
<script>
  import wepy from 'wepy'
  import { service } from '../config.js'
  import http from '../mixins/http'
  import base from '../mixins/base'
  export default class LuckDraw extends wepy.page {
    mixins = [http, base]
    config = {
      navigationBarTitleText: '抽奖详情'
    }
    data = {
      titaList: {},
      percentage: 0,
      tx: [
        '../assets/images/test/tx.jpg',
        '../assets/images/test/tx.jpg',
        '../assets/images/test/tx.jpg',
        '../assets/images/test/tx.jpg',
        '../assets/images/test/tx.jpg',
        '../assets/images/test/tx.jpg'
      ]
    }
    components = {}
    methods = {}
    onLoad (options) {
      let that = this
      if (options.id !== '') {
        this.$get({url: service.prizes + '/' + '5b1a2d9f7ff631678af8e47e'}, {
          success: ({statusCode, data}) => {
            that.titaList = data
            that.percentage = data.prize_draws_count > 0 ? parseInt(data.reach_number * data.prize_draws_count / 100) : 0
          }
        })
      }
    }
    onShow () {
    }
    formSubmit (event) {
      console.log(event)
    }
    drawBtn (event) {
      // 判断用户点击确认 并且 后台没有记录过用户信息字段为false
      if (event.detail.errMsg === 'getUserInfo:ok' && !this.data.titaList.has_upload_userinfo) {
        console.log(event)
      }
    }
  }
</script>
<style lang="scss" rel="stylesheet/scss" scoped>
  @import "../assets/stylesheets/layout.scss";
  .banner {
    display: block;
    width: 100%;
    overflow: hidden;
  }
  .describe {
    background: #fff;
    padding: 32rpx 32rpx 64rpx 32rpx;
    overflow: hidden;
    .name {
      font-size: 40rpx;
      line-height: 44rpx;
      font-weight: 600;
      color: #333333;
      float: left;
    }
    .number {
      font-size: 28rpx;
      line-height: 32rpx;
      color: #999999;
      float: right;
    }
    .reachNumber {
      clear: both;
      font-size: 24rpx;
      line-height: 32rpx;
      color: #666666;
      display: block;
      margin: 56rpx 0 60rpx;
    }
    .awardProgress {
      overflow: hidden;
      .percentageTitle {
        font-size: 24rpx;
        line-height: 32rpx;
        color: #FA5C37;
        display: block;
        float: left;
      }
      .progress {
        display: block;
        float: right;
        width: 566rpx;
        background: #F2F3F5;
        height: 24rpx;
        border-radius: 20rpx;
        margin: 6rpx 0 0 15rpx;
        view {
          margin: 4rpx 0 0 4rpx;
          height: 16rpx;
          background: linear-gradient(to right, #FB6741 , #FD9367);
          border-radius: 20rpx;
        }
      }
    }
    .participate {
      text-align: center;
      margin: 44rpx 0 32rpx;
      text {
        display: inline-block;
        font-size: 28rpx;
        line-height: 32rpx;
        color: #333333;
      }
      navigator {
        display: inline-block;
        font-size: 28rpx;
        line-height: 32rpx;
        color: #FF471C;
        border-bottom: 1rpx solid #FF471C;
      }
    }
    .participatePeople {
      overflow: hidden;
      text-align: center;
      display: block;
      position: relative;
      image {
        border-radius: 50rpx;
        display: inline-block;
        width: 72rpx;
        height: 72rpx;
        margin: 0 12rpx;
      }
      &:before {
        content: '';
        position: absolute;
        background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAECAYAAACKqs+rAAAAAXNSR0IArs4c6QAAAKJJREFUGBm1TUsOAiEUG4iElcqxNLoePQG6YcshuAAJnsXPCcajGOKGQAK+GieZzN4m8PpaWrruT2DotdYuY4wX8NbaKYQQwUcYY1Y550A745yfvfev0cPUWq8ZY4GyVSmlnXNvDoNK9yQecCi4hTZFKWXz8/ta627qgSNDfk/0iC5oC1z025WMAVxKecec4UH7QO+YEOI2876ZlNKT9Iou+B/opkhj5iraCQAAAABJRU5ErkJggg==') no-repeat;
        background-size: 24rpx 5rpx;
        width: 24rpx;
        height: 5rpx;
        top: 55rpx;
        right: 25rpx;
      }
    }
    .formSub {
      .drawBtn {
        width: 552rpx;
        height: 92rpx;
        display: block;
        background: #FA5C37;
        border-radius: 50rpx;
        color: #fff;
        margin-top: 64rpx;
      }
      text {
        font-size: 24rpx;
        line-height: 32rpx;
        color: #FA5C37;
        display: block;
        text-align: center;
        margin-top: 16rpx;
      }
    }
  }
  .sponsor {
    height: 50rpx;
    background: #F2F3F5;
    padding: 32rpx;
    overflow: hidden;
    text {
      font-size: 28rpx;
      line-height: 50rpx;
      color: #999999;
      display: block;
      float: left;
    }
    label {
      font-size: 28rpx;
      line-height: 50rpx;
      color: #333333;
      display: block;
      float: right;
    }
    image {
      width: 36rpx;
      height: 36rpx;
      display: block;
      float: right;
      border-radius: 50rpx;
      margin-top: 5rpx;
      margin-left: 10rpx;
    }
  }
  .commodityDisplay {
    display: block;
    width: 100%;
    overflow: hidden;
  }

</style>
